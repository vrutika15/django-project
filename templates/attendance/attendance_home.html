<!DOCTYPE html>
<html>
  <head>
    <title>Company Data</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- DataTables CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css"
    />
    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"> -->
  </head>

  <body>
    <div class="container mt-4">
      <!-- Tabs -->
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a
            class="nav-link active"
            id="resource-tab"
            data-bs-toggle="tab"
            href="#resource"
            role="tab"
            >Resource</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            id="project-tab"
            data-bs-toggle="tab"
            href="#project"
            role="tab"
            >Project</a
          >
        </li>
      </ul>

      <!-- Tab Contents -->
      <div class="tab-content" id="myTabContent">
        <!-- Resource Tab -->
        <div
          class="tab-pane fade show active p-3"
          id="resource"
          role="tabpanel"
        >
          <table id="resourceTable" class="table table-bordered table-striped">
            <thead class="table-dark">
              <tr>
                <th>Name</th>
                <th>Working Days</th>
                <th>Days Present</th>
                <th>Hours Present</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for resource in resources %}
              <tr>
                <td>{{ resource.resource_name }}</td>
                <td>{{ resource.working_days }}</td>
                <td>{{ resource.present_day }}</td>
                <td>{{ resource.present_hours }}</td>
                <td>
                  <a
                    href="{% url 'resource_update' resource.pk %}"
                    class="btn btn-sm btn-primary"
                    >Edit</a
                  >
                  <a
                    href="{% url 'resource_delete' resource.pk %}"
                    class="btn btn-sm btn-danger"
                    >Delete</a
                  >
                </td>
              </tr>
              {% endfor %}
              <tr class="table-secondary fw-bold">
                <td>Total</td>
                <td>{{ total_working_days }}</td>
                <td>{{ total_present_days }}</td>
                <td>{{ total_present_hours }}</td>
                <td></td>
              </tr>
              <tr class="table-secondary fw-bold">
                <td colspan="4">Presence Percentage</td>
                <td>{{ presence_percentage|floatformat:2 }}%</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Project Tab -->
        <div class="tab-pane fade p-3" id="project" role="tabpanel">
          <table
            id="projectTable"
            class="table table-striped table-bordered mt-3"
          >
            <thead class="table-dark">
              <tr>
                <th>Project Name</th>
                <th>Project Type</th>
                <th>Resource</th>
                <th>Billable Days</th>
                <th>Non-Billable Days</th>
                <th>Billable Hours</th>
                <th>Non-Billable Hours</th>
              </tr>
            </thead>
            <tbody>
              {% for proj in projects %}
              <tr>
                <td>{{ proj.project_name }}</td>
                <td>{{ proj.project_type }}</td>
                <td>
                  {% for resource in proj.resources.all %}
                  <span>{{ resource.resource_name }}</span>
                  {% if not forloop.last %}, {% endif %} {% endfor %}
                </td>
                <!--<td>{{ proj.resource_count }}</td>-->
                <td>{{ proj.billable_days }}</td>
                <td>{{ proj.non_billable_days }}</td>
                <td>{{ proj.billable_hours }}</td>
                <td>{{ proj.non_billable_hours }}</td>
              </tr>
              {% endfor %}
              <tr class="table-secondary fw-bold">
                <td colspan="3">Total</td>
                <td>{{ total_billable_days }}</td>
                <td>{{ total_non_billable_days }}</td>
                <td>{{ total_billable_hours }}</td>
                <td>{{ total_non_billable_hours }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.bootstrap5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
    <!-- DataTables Init Script -->
    <script>
      $(document).ready(function () {
        // Initialize DataTable for the active tab
        $("#resourceTable").DataTable({
          responsive: true,
          pageLength: 10,
          lengthMenu: [
            [5, 10, 25, 50],
            [5, 10, 25, 50],
          ],
          language: {
            search: "Search:",
            lengthMenu: "Show _MENU_ entries per page",
            info: "Showing _START_ to _END_ of _TOTAL_ entries",
            infoEmpty: "Showing 0 to 0 of 0 entries",
            infoFiltered: "(filtered from _MAX_ total entries)",
          },
        });

        // Handle tab switching
        $('a[data-bs-toggle="tab"]').on("shown.bs.tab", function (e) {
          let tabTarget = $(e.target).attr("href");
          let table = $(tabTarget).find("table");

          if (tabTarget === "#project") {
            // Initialize project table if not already initialized
            if (!$.fn.DataTable.isDataTable("#projectTable")) {
              $("#projectTable").DataTable({
                responsive: true,
                pageLength: 10,
                lengthMenu: [
                  [5, 10, 25, 50],
                  [5, 10, 25, 50],
                ],
                language: {
                  search: "Search:",
                  lengthMenu: "Show _MENU_ entries per page",
                  info: "Showing _START_ to _END_ of _TOTAL_ entries",
                  infoEmpty: "Showing 0 to 0 of 0 entries",
                  infoFiltered: "(filtered from _MAX_ total entries)",
                },
              });
            }
          }
          // Adjust columns for responsive behavior
          if ($.fn.DataTable.isDataTable(table)) {
            table.DataTable().columns.adjust().responsive.recalc();
          }
        });
      });
    </script>
  </body>
</html>